main:
  params: [event]
  steps:
  - log_event:
      call: sys.log
      args:
          text: ${event}
          severity: INFO
  - extract_bucket_and_file:
      assign:
      - bucket: ${event.data.bucket}
      - file: ${event.data.name}
  - log_bucket_and_file:
      call: sys.log
      args:
          text: ${file}
          severity: INFO
  - where_to_jump:  
      switch:
        - condition: ${text.substring(file, 0, 7) == "upcase_"}
          next: end
  - call_upcase_http:
      call: http.post
      args:
          url: https://us-west1-phdi-357418.cloudfunctions.net/upcase-function
          auth:
            type: OIDC
          body:
            filename: ${file}
            bucket_name: ${bucket}
  